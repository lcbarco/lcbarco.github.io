I"O<p>Hace tiempo comencé un proyecto en <a href="https://grails.org/">Grails 4</a>. En un momento del proyecto se hizo necesario en ejecutar Jobs programados a ciertas horas. Para ello <strong>Grails 4</strong> tienen implementados los Job Services. Usando la guía <a href="https://guides.grails.org/grails-scheduled/guide/index.html">Grails + @Scheduled</a> realizamos la primera versión.</p>

<p><img src="https://grails.org/images/grails_logo.svg" alt="Log de Grails" /></p>

<p>No tardé en darme cuenta que si varios Jobs se tenían que ejecutar a la vez, no se ejecutaban de forma concurrente sino secuencial.</p>

<!--more-->

<h2 id="todos-es-culpa-de-los-threads">Todos es culpa de los Threads</h2>
<p>El motivo de este comportamientos es que los Job Services usan un <strong>ThreadPoolTaskScheduler</strong> que por defecto se instancia con un solo <strong>Thread</strong>.</p>

<p>Si se revisa la <a href="https://guides.grails.org/grails-scheduled/guide/index.html">documentación</a> podemos leer el siguiente párrafo en el que se indica esta circunstancia:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>By default ThreadPoolTaskScheduler only has a single thread available for execution, which means tasks will not execute concurrently
</code></pre></div></div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c">&lt;!-- Twitter cards --&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"twitter:site"</span>    <span class="na">content=</span><span class="s">"@lcbarco"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"twitter:creator"</span> <span class="na">content=</span><span class="s">"@lcbarco"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"twitter:title"</span>   <span class="na">content=</span><span class="s">"¿Cómo asocio mi propio dominio a mi blog?"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"twitter:description"</span> <span class="na">content=</span><span class="s">"Usa tu propio dominio en tu blog"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"twitter:card"</span>  <span class="na">content=</span><span class="s">"summary_large_image"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"twitter:image"</span> <span class="na">content=</span><span class="s">"https://lcbarco.com/images/lcbarco_com.png"</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- end of Twitter cards --&gt;</span>
</code></pre></div></div>

<p>Para ello vamos a modificar el fichero <em>_includes/meta.html</em> para añadir los metas necesarios:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;!-- Twitter cards --&gt;
    &lt;meta name="twitter:site"    content="@{ { site.twitter_username }}"&gt;
    &lt;meta name="twitter:creator" content="@{ { page.author }}"&gt;
    &lt;meta name="twitter:title"   content="{ { page.title }}"&gt;

    { % if page.summary %}
    &lt;meta name="twitter:description" content="{ { page.summary }}"&gt;
    { % else %}
    &lt;meta name="twitter:description" content="{ { site.description }}"&gt;
    { % endif %}

    { % if page.image %}
    &lt;meta name="twitter:card"  content="summary_large_image"&gt;
    &lt;meta name="twitter:image" content="{ { site.url }}{ { page.image }}"&gt;
    { % else %}
    &lt;meta name="twitter:card"  content="summary"&gt;
    &lt;meta name="twitter:image" content="{ { site.title_image }}"&gt;
    { % endif %}
  &lt;!-- end of Twitter cards --&gt;
</code></pre></div></div>

<h2 id="añadir-la-información-para-generar-el-card">Añadir la información para generar el Card</h2>

<p>Una vez que hemos modificado el fichero de metas, vamos a añadir la información que va a aparecer.</p>

<p>Primero añadiremos la información general a <em>_config.yml</em>. En mi caso sólo necesitaba añadir el campo de mi cuenta de Twitter:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Global info for Twitter Cards</span>
<span class="na">twitter_username</span><span class="pi">:</span> <span class="s">lcbarco</span>
</code></pre></div></div>

<p>A continuación debemos añadir en la cabecera de cada post la información concreta del post para generar el Twitter Card:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">summary</span><span class="pi">:</span> <span class="s">Usa tu propio dominio en tu blog</span>
<span class="na">author</span><span class="pi">:</span> <span class="s">lcbarco</span>
<span class="na">image</span><span class="pi">:</span> <span class="s">/images/lcbarco_com.png</span>
</code></pre></div></div>

<p>Ahora ya si que podemos compartir nuestro post en Twitter y se generará la Card molona del mismo.
<img src="/images/card-post.png" alt="Card de Twitter al compartir" /></p>

<h2 id="conclusiones">Conclusiones</h2>
<p>Ahora gracias a nuestra Card, nuestro post quedará más lucido en Twitter. Prueba a crear el tuyo y contáctame si tienes algún problema enviándome un email a <a href="mailto:lcbarco@gmail.com">lcbarco@gmail.com</a> o a través de mi cuenta de Twitter <a href="https://twitter.com/lcbarco">https://twitter.com/lcbarco</a>.</p>

:ET